name: Keep Supabase Alive

on:
  schedule:
    - cron: '0 0 */7 * *'  # Every 7 days at midnight UTC
  workflow_dispatch:        # Allows manual runs
  push:                     # Runs when you push code (good for testing)

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check Supabase connection
        run: |
          echo "ðŸ•’ Starting at: $(date)"
          
          # Test the connection
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" \
            "$SUPABASE_URL/rest/v1/" \
            -H "apikey: $SUPABASE_ANON_KEY" \
            -H "Authorization: Bearer $SUPABASE_ANON_KEY")
          
          if [ "$RESPONSE" = "200" ]; then
            echo "âœ… SUCCESS: Supabase project is alive!"
            echo "ðŸ“¡ HTTP Status: $RESPONSE"
          else
            echo "âŒ FAILED: HTTP Status $RESPONSE"
            echo "ðŸ” Check your Supabase URL and API key"
            exit 1  # This makes the workflow fail (good for alerts)
          fi
          
          echo "ðŸ Finished at: $(date)"
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
      
      - name: Log success
        if: success()
        run: |
          echo "ðŸŽ‰ Keep-alive completed successfully!" >> $GITHUB_STEP_SUMMARY
          echo "Timestamp: $(date -u)" >> $GITHUB_STEP_SUMMARY
